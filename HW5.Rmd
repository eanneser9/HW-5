---
title: "HW 5"
author: "Ely Anneser"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  echo    = TRUE, 
  message = FALSE,
  warning = FALSE,
  error = FALSE
)



library(tidyverse)
library(purrr)
library(tidyr)
library(broom)
library(knitr)
library(ggplot2)
library(ggthemes)
library(stringr)
library(ggbeeswarm)
library(sf)
library(tigris)
```
Take the following steps to set up your GitHub repository for the homework (we will work on this as an in-course exercise):
1.	Set up a local (i.e., on your computer) R project with subdirectories for the data, writing (this is where you’ll put your Rmarkdown file and the output file), and figures.
2.	Download the Washington Post data and save it in an appropriate place in this R project directory.
3.	Initialize git for the R project and make your initial commit.
4.	Create an RMarkdown file for your homework answers in the appropriate subdirectory and save it. Commit this change with an appropriate commit message. (At this stage, you can look at your “History” in the git commit window to see the changes you’ve made so far.)
5.	Login to your GitHub account and create a new, blank repo with the same name as your R project. (If you have not already set up an SSH key to make it easier to push back and forth between your computer and GitHub, do so now.)
6.	On your computer, specify your GitHub repository as the remote for your project and do an initial push to send all the files to the GitHub repo. Look at your repository on GitHub to make sure it worked.
7.	Add a README.md file to the top level of your R project (on your local computer) using Markdown syntax and then commit the change locally and push to your GitHub repository.
For the README.md file, you can create a text file in RStudio and save it as “README.md”. You can then write this file using Markdown syntax (like RMarkdown, but without any code chunks).
As you work on your homework, make sure you commit regularly (with helpful commit messages). You should have at least 15 commit messages in your history for the repo by the time you turn in the homework.

1.	Choice 1: Pick one city in the data. Create a map showing the locations of the homicides in that city, using the sf framework discussed in class. Use tigris to download boundaries for some sub-city geography (e.g., tracts, block groups, county subdivisions) to show as a layer underneath the points showing homicides. Use different facets for solved versus unsolved homicides and different colors to show the three race groups with the highest number of homicides for that city (you may find the fct_lump function from forcats useful for this).

```{r}
ma_map <- tracts(state = "MA",county = "Suffolk", cb = TRUE, class = "sf")

#suffolk <- ma_map %>% 
#  filter(NAMELSAD == "Suffolk County")

ggplot()+
  geom_sf(data = suffolk)

crime <- read_csv("data/homicide-data.csv")

crime <- crime %>% 
  mutate(city_name = str_c(city, ", ", state))%>% 
  mutate(date = ymd(reported_date))

head(crime)


unsolved_lvls <- c("Open/No arrest", "Closed without arrest")


boston <- crime %>%
  group_by(city_name) %>% 
  ungroup() %>% 
  filter(city_name == "Boston, MA") %>% 
  drop_na(lat, lon) %>% 
  mutate(
    disposition = recode(disposition,
      "Closed without arrest" = "Unsolved",
      "Open/No arrest"        = "Unsolved",
      "Closed by arrest"      = "Solved")) %>% 
  mutate(victim_race = fct_lump(fct_infreq(victim_race), n = 3))

boston <- st_as_sf(boston, coords = c("lon", "lat")) %>% 
  st_set_crs(4269)
  

ggplot()+
  geom_sf(data = ma_map, color ="lightgray")+
  geom_sf(data= boston, aes(color = victim_race))+
  facet_wrap(~disposition)+
  theme(panel.background = element_rect(fill = "grey56"), 
        panel.grid.major = element_line(color = "grey45"),
        panel.grid.minor = element_line(color = "grey45"),
        legend.position = "bottom")+
  scale_fill_manual(name = NULL)
  
```





2.	Choice 2: Recreate the graph shown below. It shows monthly homicides in Baltimore, with a reference added for the date of the arrest of Freddie Gray and color used to show colder months (November through April) versus warmer months (May through October). There is a smooth line added to help show seasonal and long-term trends in this data.

```{r fig.height= 3, fig.width=15}



balt<- crime %>% 
  filter(city_name == "Baltimore, MD") %>% 
  mutate(month = month(date)) %>% 
  mutate(month_year = floor_date(date,"month"))%>% 
  mutate(season = case_when(
      month %in% c(11, 12, 1, 2, 3, 4) ~ "winter",
      month %in% c(5, 6, 7, 8, 9, 10) ~ "summer")) %>% 
  group_by(month_year, season) %>% 
  summarise( n_total    = n()) 
  
freddie_gray_date <- as.Date("2015-04-12")  


balt %>% 
  ggplot()+
  geom_col(aes(x = month_year, y = n_total, fill = season))+
  labs(x = "Date", y = "Monthly homicides", title = "Homicides in Baltimore, MD")+
  theme(panel.background = element_rect(fill = "grey56"), 
        panel.grid.major = element_line(color = "grey45"),
        panel.grid.minor = element_line(color = "grey45"),
        legend.position = "bottom")+
  scale_fill_manual(
  values = c("summer" = "grey85","winter" = "cadetblue2"),
  name = NULL)+
  geom_vline(xintercept = freddie_gray_date,
    linetype = "dashed",
    linewidth = 1.5,
    color = "red") +
  geom_text(aes(x = freddie_gray_date-80, y = 40),
    label = "Arrest of\nFreddie Gray",
    color = "grey85",
    size = 5,
    hjust = 1) +
geom_smooth(aes(x = month_year, y = n_total),
  method = "loess",
  span = 0.1,
  se = FALSE,
  linewidth = 1.2,
  color = "dodgerblue3")

```

I know we had the choice to do one or the other, but I wanted to try both. 